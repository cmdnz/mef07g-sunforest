---
title: "SunForest Shiny App"
output: quarto::quarto_shiny
runtime:
  shiny: true
---
# install.packages(c("shiny", "dplyr", "ggplot2"))

# Load libraries
library(shiny)
library(dplyr)
library(ggplot2)

# Load your data
load("pisa.RData")

# Define UI
ui <- fluidPage(
  titlePanel("PISA 2022 Exploratory Data Analysis"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("plotType", "Select Plot Type", 
                  choices = c("Mean Math Score by Country", 
                              "Mean Science Score by Country", 
                              "Mean Reading Score by Country",
                              "Mean Scores by Lack of Teaching Staff",
                              "Mean Math Score by Professional Development",
                              "Mean Math Score by Percentage of Teaching Staff Attended PD",
                              "Mean Math Score by School Type")),
      checkboxInput("filterOECD", "Filter by OECD Countries", value = TRUE),
      conditionalPanel(
        condition = "input.plotType == 'Mean Math Score by Percentage of Teaching Staff Attended PD'",
        sliderInput("percentageSlider", "Select Percentage Range", min = 0, max = 100, value = c(0, 100))
      )
    ),
    
    mainPanel(
      plotOutput("plot")
    )
  )
)

# Define server
server <- function(input, output) {
  
  # Filter data based on OECD countries
  filteredData <- reactive({
    if (input$filterOECD) {
      pisa_filtered <- pisa[pisa$OECD_x == 1, ]
    } else {
      pisa_filtered <- pisa
    }
    pisa_filtered
  })
  
  # Create plot based on user input
  output$plot <- renderPlot({
    pisa_data <- filteredData()
    
    # Plot based on selected option
    if (input$plotType == "Mean Math Score by Country") {
      plot_data <- pisa_data %>%
        group_by(CNT) %>%
        summarise(mean_math = mean(mean_math, na.rm = TRUE))
      
      ggplot(plot_data, aes(x = reorder(CNT, mean_math), y = mean_math)) +
        geom_bar(stat = "identity", fill = "darkblue") +
        coord_flip() +
        labs(title = "Mean Math Score by Country",
             x = "Country",
             y = "Mean Math Score") +
        theme_bw() +
        theme(plot.title = element_text(hjust = 0.5))
    }
    # Add more conditions for other plot types...
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)
